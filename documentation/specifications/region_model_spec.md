This is the schema specification for the _Region model_. [TODO: Link to JSON Schema.] Region model files can be validated by running the validate.py utility. [TODO: Link to validation script]

A _Region Model_ defines a large spatio-temporal area of interest (a "Region"). Consequently, a Region Model **must** contain exactly one feature of the Region type, as specified below. It may include zero or more _Site Summary_ features, also specified below.

The only two types of feature permitted in a Region Model will be `region` and `site_summary`. Features of different types, or features that do not have a defined type, are malformed.

The _region model_ may either be fed into the inference algorithm to initiate inference or be used as input to the evaluation software to indicated what spatio-temporal region to evaluate. 

The _site_id_ is a unique index that serves as the primary link between sites that exist within region bounds and the site model annotation itself. 

# Region Feature

As mentioned in the common model documentation, a Region Feature is expected to define its geometry and type. A Region Feature's geometry **must be** a Polygon. The following is a list of properties that are also expected to be defined in the Region's `properties` property. **All of these are mandatory**.

### `type` (string)

This must be set to the string `"region"`

This is specific to the region feature, and is used to differentiate regions from site features.

### `region_id` (string)

This must be a string of the format `<2-digit country code>_{R|C|S}###`.

This is a unique identifier for this specific region. The two-digit country codes are the codes specified by [ISO 3166](https://en.wikipedia.org/wiki/ISO_3166).
| Letter | Description / Use |
|--------|-------------------|
| R | Standard Region Model identifier. Typically generated by annotation team. |
| C | Refers to regions where 'coarse' labeling was completed. This indicates a possibility of higher label noise than sites annotated in 'R' regions and also indicates a higher likelihood that some activities within the region bounds are not annotated (missed annotations). |
| S | Used to indicate a 'Super-Region', which will contain one or more 'standard' or 'coarse' regions (Not used in open source dataset). |

### `version` (string)

This must be a string of the format `#.#.#`.

Region models will be given version numbers to enable tracking of changes \*\*to the model\*\* which may occur over time. Versioning will use a Semantic Versioning construct (MAJOR.MINOR.PATCH). Updates to the version numbers will follow this format:

* **MAJOR increment**
  * This corresponds to the MAJOR version of the region model spec that is being used. An increment of this type indicates that metadata fields have been added or removed, or that their type has been modified.
* **MINOR increment**
  * This is incremented to indicate that sites have been added to, or removed from, the region model.
* **PATCH increment.**
  * This is incremented to indicate that the content of existing features has been modified (e.g. geometries have been updated, or properties have been modified).

Incrementation indicates a single operation has taken place, not that a single modification has taken place. For example, a task that added three sites to a file versioned 1.0.0 would change the semantic version to 1.1.0, not to 1.3.0.

### `mgrs` (string)

This is the [MGRS](https://en.wikipedia.org/wiki/Military_Grid_Reference_System grid ID at the 100km precision level for the region’s centroid. 
For non-polar regions, the grid zone designator should be zero-padded e.g. rather than `4QFJ` you would use `04QFJ`. 
Accordingly, non-polar regions should have a five-letter MGRS string, two numerics followed by three alphabetics.
Polar regions should have only three alphabetics.


### `model_content` (string)

This must be one of the three strings `["empty", "annotation", "proposed"]`

<table>
<tr>
<th>Label</th>
<th>Description</th>
</tr>
<tr>
<td>'empty'</td>
<td>Indicates that the region model contains no site summaries. Empty region models are typically used as input to the system to initiate processing (inference).</td>
</tr>
<tr>
<td>'annotation'</td>
<td>

Indicates that the region model contains annotated (ground truth) site models.

For annotations (ground truth) contained within the SMART Heavy Construction dataset, 'originator' field will always be 'te', referring to the "Test and Evaluation" team (the team that created the annotation dataset).
</td>
</tr>
<tr>
<td>'proposed'</td>
<td>Indicates that contents of the model were generated/proposed by a model/algorithm.</td>
</tr>
</table>

### `start_date` (string or null)

This value may either be `null` or a datestring of the format `"YYYY-MM-DD"`.

If the value of `model_content` is either “annotation” or “proposed”, this will correspond to the earliest date of any site within the region bounds. If the value of `model_content` is “empty”, then this may be any arbitrary start date. 

### `end_date` (string or null)

This value may either be `null` or a datestring of the format `"YYYY-MM-DD"`.

If the value of `model_content` is either “annotation” or “proposed”, this will correspond to the latest end date of any site within the region bounds. If the value of `model_content` is “empty”, then this may be any arbitrary end date.  If the region is of continuing interest, then the value may be set to `null`.

### `originator` (string)

This field indicates who produced the region model. In the SMART Heavy Construction Dataset, all annotation (ground truth) files will contain one of the strings `["te", "iMERIT"]`. 

## Optional Field(s)

### `comments` (string or null)

This is an unstructured string that provides information about the general status of the region or other information as required. If it is unused, it should be set as `null`.

### `cache` (dictionary, optional)

This is an unstructured dictionary field that can contain an arbitrary payload. Performers may write any content that they need to persist during processing to this field. Final consumers of the region model should ignore this content. If this key is missing, software should treat it as an empty dictionary object. If the key is deliberately unused, it should be set to the empty dictionary `{}`. It should not be set as `null`.

NOTE: In early versions of the site model schema, a `performer_cache` property was defined. As of schema version 0.7.0, this property replaces the use of the `performer_cache` property. Currently, use of the old key is still supported, but migration to the new key is recommended for all future implementations.

# Site (Summary) Feature

A Region Model may have zero or more Site Summaries inside of it, and all Site Summaries are assumed to belong to that Region. There is no checking for polygon intersection, but the assumption is that all Site Summaries are fully enclosed by their Region.

As with a Region, a Site Summary is expected to be a Polygon, and may contain voids. However, void regions should not be expected to be removed or ignored by downstream tools.

Site Summary features within the Region Model are summaries of Site Models. All of the information herein should be extracted directly from the corresponding Site Model.

The following is a list of all properties defined within a Site Summary feature's `properties`. Unless explicitly noted, they are all **mandatory.**

### `type` (string)

This must be set to "site_summary".

This is the only property that is not extracted from the corresponding site model.

### `site_id` (string)

This must be a string of the form `<region_id>_####`.

Each site model within a given region should have a unique four-digit index at the end. Unique IDs of sites do not need to be contiguous, e.g. the existence of site XX_R000_0000 and XX_R000_0002 does not imply the existence of site XX_R000_0001.

### `version` (string)

This must be a string of the format `#.#.#`.

Site models will be given version numbers to enable tracking of changes **to the model** which occur over time.

Versioning will use a Semantic Versioning construct (MAJOR.MINOR.PATCH). Updates to the version numbers will follow this format:

* **MAJOR increment**
  * This corresponds to the MAJOR version of the site model spec that is being used. An increment of this type indicates that metadata fields have been added or removed, or that their type has been modified.
* **MINOR increment**
  * This is incremented to indicate that observations have been added to, or removed from, the site model.
* **PATCH increment.**
  * This is incremented to indicate that the content of existing features has been modified (e.g. geometries have been updated, or properties have been modified).

Incrementation indicates a single operation has taken place, not that a single modification has taken place. For example, a task that added three observations to a file versioned 1.0.0 would change the semantic version to 1.1.0, not to 1.3.0.

### `mgrs` (string)

This is the [MGRS](https://en.wikipedia.org/wiki/Military_Grid_Reference_System grid ID at the 100km precision level for the region’s centroid. 
For non-polar regions, the grid zone designator should be zero-padded e.g. rather than `4QFJ` you would use `04QFJ`. 
Accordingly, non-polar regions should have a five-letter MGRS string, two numerics followed by three alphabetics.
Polar regions should have only three alphabetics.

### `status` (string)

This must be one of the strings found on the list of (TODO: Update [canonical site types](https://smartgitlab.com/TE/annotations/-/wikis/Annotation-Status-Types)).

### `start_date` (string or null)

This value may either be `null` or a datestring of the format `"YYYY-MM-DD"`.

If it is a datestring, this date corresponds to the earliest date of all observation features in this site model. `null` has a special semantic meaning and is only permitted in certain statused sites, as detailed in the (TODO: Update [canonical site types](https://smartgitlab.com/TE/annotations/-/wikis/Annotation-Status-Types)).

### `end_date` (string or null)

This value may either be `null` or a datestring of the format `"YYYY-MM-DD"`.

If it is a datestring, it corresponds to the latest date of all observation features in this site model. `null` has a special semantic meaning and is only permitted in certain statused sites, as detailed in the (TODO: Update [canonical site types](https://smartgitlab.com/TE/annotations/-/wikis/Annotation-Status-Types)).

### `model_content` (string)

This must be one of the two strings `["annotation", "proposed"]`

An "annotation" site is defined by the program, while "proposed" sites are defined by performers. Unlike the similarly named property of a Region feature, a Site may not have the model_content "empty".

### `originator` (string)

This field indicates who produced the site model. In the SMART Heavy Construction Dataset, all annotation (ground truth) files will contain one of the strings `["te", "iMERIT"]`.

The following properties may also optionally be defined:

### `comments` (string, optional)

This is an unstructured string that provides information about the general status of the region or other information as required.

### `score` (float, optional)

This must be a value in the range \[0.0, 1.0\].

This is the "confidence score" of this site, with 1.0 being highest confidence and 0.0 being lowest confidence. If this property is not defined, it will be treated as though the score is 1.0.

### `validated` (string, optional)

This is either the string "True" or the string "False".

**Warning:** The use of JSON literal booleans in this field is malformed.

If the site has been validated by the annotation team, it may receive the string "True"; otherwise it is "False". If this property is not defined, it will be treated as though the string is "False".

### `cache` (dictionary, optional)

This is an unstructured dictionary field that can contain an arbitrary payload. Performers may write any content that they need to persist during processing to this field. Final consumers of the region model should ignore this content. If this key is missing, software should treat it as an empty dictionary object. If the key is deliberately unused, it should be set to the empty dictionary `{}`. It should not be set as `null`.

NOTE: In early versions of the site model schema, a `annotation_cache` property was defined. As of schema version 0.7.0, this property replaces the use of the `annotation_cache` property. Currently, use of the old key is still supported, but migration to the new key is recommended for all future implementations.

# Region Model example

```plaintext
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "type": "region",
        "region_id": "US_R001",
        "version": "2.0.1",
        "mgrs": "17RMP",
        "start_date": "1980-01-01",
        "end_date": "2038-01-19",
        "model_content": "proposed",
        "originator": "xyz",
        "comments": "Uses version 17.2.3 of Algorithm X"
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [80.0,0.0],[81.0,0.0],[81.0,1.0],[80.0,1.0],[80.0,0.0]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "type": "site_summary",
        "site_id": "US_R001_0001",
        "version": "2.1.2",
        "mgrs": "17RMP",
        "status": "system_rejected",
        "start_date": "1980-01-01",
        "end_date": "1983-01-01",
        "score": 0.0,
        "model_content": "proposed",
        "originator": "xyz"
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [80.5,0.5],[80.55,0.5],[80.55,0.55],[80.5,0.55],[80.5,0.5]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "type": "site_summary",
        "site_id": "US_R001_0002",
        "version": "2.0.3",
        "mgrs": "17RMP",
        "status": "system_confirmed",
        "start_date": "1983-03-25",
        "end_date": "1984-09-08",
        "score": 0.75,
        "model_content": "proposed",
        "originator": "xyz"
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [80.7,0.7],[80.75,0.7],[80.75,0.75],[80.7,0.75],[80.7,0.7]
          ]
        ]
      }
    }
  ]
}
```
